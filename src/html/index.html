<html>
<head>
    <script src="https://unpkg.com/systemjs@0.19.39/dist/system.src.js" type="application/javascript"></script>
    <script src="./assets/jquery-3.1.1.min.js" type="application/javascript"></script>
    <script src="app.js" type="application/javascript"></script>
    <link rel="stylesheet" type="text/css" href="./css/debugger.css">
    <link rel="stylesheet" type="text/css" href="./css/main.css">
</head>
<body>

<div style="display: flex; flex-direction: row;">
    <div id="screenContainer">
        <canvas id="screen"></canvas>
    </div>

    <!-- Debugger -->
    <div class="debugger">
        <div style="display: flex; flex-direction: row;">
            <fieldset>
                <legend>CONSOLE</legend>
                <div style="color: #bebebe; display: inline-block">
                    <ul style="list-style: none;">
                        <li>
                            <span class="header">CPU Cycles:</span>
                            <span id="cpucycles"></span>
                        </li>
                        <li>
                            <span class="header">PPU Cycles:</span>
                            <span id="ppuCycles">0</span>
                        </li>
                        <li>
                            <span class="header">Scanlines:</span>
                            <span id="scanlunes">0</span>
                        </li>
                        <li>
                            <span class="header">Ticks:</span>
                            <span id="ticks"></span>
                        </li>
                    </ul>
                </div>
            </fieldset>
            <fieldset>
                <legend>OPERATION</legend>
                <div style="color: #bebebe; display: inline-block">
                    <ul style="list-style: none;">
                        <li>
                            <span class="header">Code:</span>
                            <span id="opcode"></span></li>
                        <li>
                        <li>
                            <span class="header">Name:</span>
                            <span id="opname"></span></li>
                        <li>
                            <span class="header">Mode:</span>
                            <span id="opmode"></span>
                        </li>
                        <li>
                            <span class="header">Address:</span>
                            <span id="opaddr"></span>
                        </li>
                    </ul>
                </div>
            </fieldset>
        </div>
        <fieldset>
            <legend>CPU</legend>
            <div style="color: #bebebe; display: inline-block">
                <ul style="list-style: none;">
                    <li>
                        <span class="header">PC:</span>
                        <span id="pc"></span></li>
                    <li>
                        <span class="header">SP:</span>
                        <span id="sp"></span>
                    </li>
                    <br />
                    <li>
                        <span class="header">AF:</span>
                        <span id="af"></span>
                    </li>
                    <li>
                        <span class="header">BC:</span>
                        <span id="bc"></span>
                    </li>
                    <li>
                        <span class="header">DE:</span>
                        <span id="de"></span>
                    </li>
                    <li>
                        <span class="header">HL:</span>
                        <span id="hl"></span>
                    </li>
                </ul>
            </div>
        </fieldset>

    </div>
</div>
<div class="debugger" style="display: flex; flex-direction: row; margin-left: 10px;">
    <fieldset>
        <legend>LOG</legend>
        <div class="log" style="color: #bebebe; display: inline-block">
            <ul>

            </ul>
        </div>
    </fieldset>
</div>


<script>
    var gameboy = null;
    var debug = null;

    var loadGameBoy = function() {
        System.import('gameboy').then(function(e) {
            try {
                gameboy = new e.GameBoy();
            } catch (e) {
                console.error("Unable to load GameBoy");
                console.error(e);
                return;
            }

            gameboy.load("./roms/Tetris.gb");
            gameboy.reset();
            loadDebugger();
            console.info("Gameboy is ready!");
        }).catch(
            function(err){
                console.error("Unable to load GameBoy");
                console.error(err);
            }
        );
    }

    var loadDebugger = function() {
        System.import('debugger').then(function(e) {
            try {
                debug = e.Debugger;
            } catch (e) {
                console.error("Unable to load Debugger");
                console.error(e);
                return;
            }
            debug.init(gameboy);
        }).catch(
            function(err){
                console.error("Unable to load Debugger");
                console.error(err);
            }
        );
    }

    loadGameBoy();
</script>
</body>
</html>